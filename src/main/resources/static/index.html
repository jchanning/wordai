<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>WordAI Game - Web Interface</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="css/style.css?v=20260215_2000">
</head>
<body>
    <div class="header-bar">
        <div class="app-header">
            <div class="app-header-left">
                <button class="hamburger-menu" id="hamburgerMenu" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="appNav">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <h1 class="header-title">WordAI</h1>
                <nav class="app-nav" id="appNav" aria-label="Application Modes">
                    <a class="nav-link" href="#/play" data-nav="play">Play</a>
                    <a class="nav-link" href="#/bot-demo" data-nav="bot-demo">Auto</a>
                    <a class="nav-link" href="#/bot-performance" data-nav="bot-performance">Analyse</a>
                    <a class="nav-link" href="#/dictionary" data-nav="dictionary">Dictionary</a>
                    <a class="nav-link" href="#/admin" data-nav="admin">Admin</a>
                    <a class="nav-link" href="#/help" data-nav="help">Help</a>
                </nav>
            </div>
            <div class="app-header-right">
                <div class="user-info" id="userInfo" style="display: none;">
                    <span class="user-name" id="userName"></span>
                    <span id="roleIndicator" class="role-badge"></span>
                    <button class="btn btn-secondary btn-sm" onclick="logout()">Logout</button>
                </div>
                <a class="nav-link-signin" id="signInLink" href="/login.html" style="display: none;">Sign In</a>
            </div>
        </div>
    </div>

    <main class="app-main">
        <!-- Screen: Interactive Play -->
        <section id="screen-play" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Interactive Play</h2>
                </div>
                <div class="screen-toolbar-right">
                </div>
            </div>

            <div id="playGameHost">
            <div class="main-layout" id="gameView">
        <!-- Left Column: Game History -->
            <div class="history-panel panel play-panel">
            <div class="panel-header-row">
                <h3>Session</h3>
                <div class="panel-header-actions">
                    <button class="btn btn-success btn-md" onclick="newSession()">New</button>
                    <button class="btn btn-secondary btn-md" onclick="showSessionViewer()">View</button>
                </div>
            </div>
            <div class="win-rate-stat">
                <div class="win-rate-label">Win Rate</div>
                <div class="win-rate-value" id="stat-winrate">0%</div>
            </div>
            <div class="stats-grid">
                <!-- Row 1: Total, Won, Lost -->
                <div class="stat-item">
                    <div class="stat-label">Total</div>
                    <div class="stat-value" id="stat-total">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Won</div>
                    <div class="stat-value" id="stat-won">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Lost</div>
                    <div class="stat-value" id="stat-lost">0</div>
                </div>
                <!-- Row 2: Min, Max, Avg -->
                <div class="stat-item">
                    <div class="stat-label">Min</div>
                    <div class="stat-value" id="stat-min">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Max</div>
                    <div class="stat-value" id="stat-max">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Avg</div>
                    <div class="stat-value" id="stat-avg">-</div>
                </div>
            </div>
            
            <h3>Guess Distribution</h3>
            <div id="attemptsDistribution" class="surface-box surface-box-md">
                <p class="muted-center muted-small">No games played yet</p>
            </div>
            
            <div class="panel-header-row">
                <h3>Recent Games</h3>
                <button class="btn btn-success btn-xs" onclick="exportSessionGamesToCSV()" title="Export all session games to CSV" data-role="premium">Export CSV</button>
            </div>
            <div class="game-history" id="game-history">
                <p class="empty-history-msg muted-center">No games played yet</p>
            </div>
        </div>
        
        <!-- Middle Column: Game Board -->
        <div class="game-container panel play-panel">
            <div class="panel-header-row">
                <h3>Game</h3>
                <div class="panel-header-actions">
                    <select id="dictionarySelector" class="dictionary-selector" onchange="onDictionaryChange()">
                        <option value="">Loading dictionaries...</option>
                    </select>
                    <button class="btn btn-success btn-md" onclick="newGame()">New</button>
                </div>
            </div>
            
            <div class="game-info">
                <div>Attempts: <span id="attempts">0</span>/<span id="maxAttempts">6</span></div>
            </div>
            
            <div class="guess-container">
                <div class="letter-inputs" id="letterInputs">
                    <!-- Letter inputs will be dynamically generated based on selected dictionary -->
                </div>
            </div>
            
            <div class="guess-history" id="guessHistory"></div>
            
            <div class="keyboard-container">
                <div class="keyboard" id="gameKeyboard">
                    <!-- On-screen keyboard buttons will be generated dynamically -->
                </div>
            </div>
        </div>
        
        <!-- Right Column: Analytics -->
        <div class="info-panel panel play-panel">
            <div class="panel-header-row">
                <h3>Assistant</h3>
                <div class="panel-header-actions panel-header-actions-inline">
                    <select id="strategySelector" class="form-input strategy-selector" onchange="changeStrategy()">
                        <option value="RANDOM">Random Selection</option>
                        <option value="ENTROPY">Maximum Entropy</option>
                        <option value="BELLMAN_FULL_DICTIONARY">Bellman Full Dictionary</option>
                    </select>
                    <button id="getSuggestionBtn" class="btn btn-info btn-md" onclick="getSuggestion()">
                        Assist <span id="helpCounter" class="help-counter-inline">3/3</span>
                    </button>
                </div>
            </div>
            
            <div class="analytics-grid">
                <!-- Left Column: Key Statistics + Visual Analysis -->
                <div class="analytics-left-col">
                    <details class="analytics-collapsible" open>
                        <summary class="analytics-summary">Key Statistics</summary>
                        <div class="analytics-content">
                            <div class="info-section">
                                <div class="info-label">Word Count:</div>
                                <div class="info-value" id="totalWords">2315</div>
                            </div>
                            
                            <div class="info-section">
                                <div class="info-label">Remaining:</div>
                                <div class="info-value" id="remainingWords">2315</div>
                            </div>
                            
                            <div class="info-section">
                                <div class="info-label">Eliminated:</div>
                                <div class="info-value" id="eliminatedWords">0</div>
                            </div>
                            
                            <div class="info-section">
                                <div class="info-label">Reduction %:</div>
                                <div class="info-value" id="reductionPercent">0%</div>
                            </div>
                            
                            <div class="info-section">
                                <div class="info-label">Unique Letters:</div>
                                <div class="info-value" id="uniqueLetters">26</div>
                            </div>
                            
                            <div class="info-section">
                                <div class="info-label">Total Letter Count:</div>
                                <div class="info-value" id="letterCount">-</div>
                            </div>
                        </div>
                    </details>
                    
                    <details class="analytics-collapsible" open>
                        <summary class="analytics-summary">Visual Analysis</summary>
                        <div class="analytics-content">
                            <div class="analytics-section">
                                <h4 class="analytics-section-title">Total Letters by Position</h4>
                                <div id="columnLengthsChart" class="bar-chart-box">
                                    <!-- Bar chart will be dynamically generated here -->
                                </div>
                            </div>
                            
                            <div class="analytics-section">
                                <h4 class="analytics-section-title">Most Common Letters</h4>
                                <div id="mostFrequentTable" class="analytics-box">
                                    <!-- Table will be dynamically generated here -->
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
                
                <!-- Right Column: Letters by Position -->
                <details class="analytics-collapsible analytics-right-col" open>
                    <summary class="analytics-summary">Letters by Position</summary>
                    <div class="analytics-content">
                        <div class="analytics-section">
                            <h4 class="analytics-section-title">Letters by Position</h4>
                            <div id="occurrenceTable" class="analytics-box">
                                <!-- Table will be dynamically generated here -->
                            </div>
                        </div>
                    </div>
                </details>
            </div>
        </div>
    </div>
            </div>

        </section>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-bottom-nav" id="mobileBottomNav">
            <button class="mobile-nav-btn" data-view="session" onclick="switchMobileView('session')" aria-label="Session view">
                <span class="mobile-nav-icon">üìä</span>
                <span class="mobile-nav-label">Session</span>
            </button>
            <button class="mobile-nav-btn active" data-view="game" onclick="switchMobileView('game')" aria-label="Game view">
                <span class="mobile-nav-icon">üéÆ</span>
                <span class="mobile-nav-label">Game</span>
            </button>
            <button class="mobile-nav-btn" data-view="assistant" onclick="switchMobileView('assistant')" aria-label="Assistant view">
                <span class="mobile-nav-icon">ü§ñ</span>
                <span class="mobile-nav-label">Assistant</span>
            </button>
        </nav>

        <!-- Screen: Session Analytics -->
        <section id="screen-session" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Session Analytics</h2>
                </div>
                <div class="screen-toolbar-right">
                    <button class="btn btn-secondary" onclick="hideSessionViewer()">‚Üê Back to Game</button>
                </div>
            </div>
            <div id="sessionViewer" class="session-viewer-panel" style="display:block;">
                <div id="sessionContent" class="panel"></div>
            </div>
        </section>

        <!-- Screen: Bot Demo (Autoplay) -->
        <section id="screen-bot-demo" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Auto</h2>
                    <div class="screen-subtitle">Watch an algorithm play automatically.</div>
                </div>
                <div class="screen-toolbar-middle bot-demo-toolbar-progress">
                    <div class="progress-row">
                        <div id="autoplayProgressText" class="progress-text" role="status" aria-live="polite" aria-atomic="true">Not running</div>
                        <progress id="autoplayProgressBar" value="0" max="100" class="progress-bar" aria-label="Autoplay progress" aria-describedby="autoplayProgressText"></progress>
                    </div>
                </div>
                <div class="screen-toolbar-right">
                    <button id="autoplayBtn" class="btn btn-info" onclick="toggleAutoplay()" aria-controls="autoplayProgressBar botDemoGameHost autoplaySetupPanel">Autoplay Games</button>
                </div>
            </div>

            <details class="panel bot-demo-setup" id="autoplaySetupPanel" open>
                <summary class="bot-demo-setup-summary">Setup</summary>
                <div class="form-grid bot-demo-setup-grid">
                    <div class="form-group">
                        <label for="autoplayGameCount">Number of Games</label>
                        <input type="number" id="autoplayGameCount" min="1" max="1000" value="100" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="autoplayWordLength">Word Length</label>
                        <select id="autoplayWordLength" class="form-input" onchange="filterAutoplayDictionaries()">
                            <option value="4">4 Letters</option>
                            <option value="5" selected>5 Letters</option>
                            <option value="6">6 Letters</option>
                            <option value="7">7 Letters</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="autoplayStrategy">Strategy</label>
                        <select id="autoplayStrategy" class="form-input">
                            <option value="RANDOM">Random Selection</option>
                            <option value="ENTROPY" selected>Maximum Entropy</option>
                            <option value="MOST_COMMON_LETTERS">Most Common Letters</option>
                            <option value="MINIMISE_COLUMN_LENGTHS">Minimise Column Lengths</option>
                            <option value="DICTIONARY_REDUCTION">Dictionary Reduction</option>
                            <option value="BELLMAN_OPTIMAL">Bellman Optimal</option>
                            <option value="BELLMAN_FULL_DICTIONARY">Bellman Full Dictionary</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="autoplayDelay">Delay Between Guesses (ms)</label>
                        <input type="number" id="autoplayDelay" min="0" max="5000" step="100" value="1000" class="form-input">
                    </div>
                    <div class="form-group bot-demo-setup-wide">
                        <label for="autoplayDictionary">Dictionary</label>
                        <select id="autoplayDictionary" class="form-input">
                            <option value="">Use first available</option>
                        </select>
                    </div>
                </div>
            </details>

            <div id="botDemoGameHost" class="bot-demo-game-host"></div>
        </section>

        <!-- Screen: Bot Performance (Player Analysis) -->
        <section id="screen-bot-performance" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Analyse</h2>
                    <div class="screen-subtitle">Systematically test performance across a dictionary.</div>
                </div>
                <div class="screen-toolbar-right">
                    <button id="startAnalysisBtn" class="btn btn-success" onclick="startPlayerAnalysis()" aria-controls="analysisProgressBar analysisResults analysisSetupPanel">Start Analysis</button>
                    <button id="cancelAnalysisBtn" class="btn btn-danger" onclick="cancelPlayerAnalysis()" aria-controls="analysisProgressBar" disabled>Cancel</button>
                </div>
            </div>

            <div class="panel bot-performance-progress">
                <h3>Progress</h3>
                <div class="progress-row">
                    <div id="analysisProgressText" class="progress-text" role="status" aria-live="polite" aria-atomic="true">Not running</div>
                    <progress id="analysisProgressBar" value="0" max="100" class="progress-bar" aria-label="Analysis progress" aria-describedby="analysisProgressText analysisProgressHint"></progress>
                </div>
                <div class="hint" id="analysisProgressHint">Cancel stops after the current word completes.</div>
            </div>

            <details class="panel bot-performance-setup" id="analysisSetupPanel" open>
                <summary class="bot-performance-setup-summary">Setup</summary>
                <div class="form-grid bot-performance-setup-grid">
                    <div class="form-group">
                        <label for="analysisStrategy">Selection Algorithm</label>
                        <select id="analysisStrategy" class="form-input">
                            <option value="RANDOM">Random Selection</option>
                            <option value="ENTROPY" selected>Maximum Entropy</option>
                            <option value="MOST_COMMON_LETTERS">Most Common Letters</option>
                            <option value="MINIMISE_COLUMN_LENGTHS">Minimise Column Lengths</option>
                            <option value="DICTIONARY_REDUCTION">Dictionary Reduction</option>
                            <option value="BELLMAN_OPTIMAL">Bellman Optimal</option>
                            <option value="BELLMAN_FULL_DICTIONARY">Bellman Full Dictionary</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="analysisDictionary">Dictionary</label>
                        <select id="analysisDictionary" class="form-input">
                            <option value="">Loading dictionaries...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="analysisDelay">Delay between games (ms)</label>
                        <input type="number" id="analysisDelay" min="0" max="5000" step="100" value="0" class="form-input">
                    </div>
                </div>
            </details>

            <!-- Player Analysis Results Section (hidden by default) -->
            <div id="analysisResults" class="analysis-results" style="display: none;">
                <div class="analysis-results-header">
                    <h2 class="analysis-results-title">Player Analysis Results</h2>
                    <button class="btn btn-secondary" onclick="hideAnalysisResults()">Close</button>
                </div>

                <div class="panel analysis-results-panel">
                    <h3>Summary Statistics</h3>
                    <div id="analysisSummary"></div>
                    <button class="btn btn-success analysis-download-btn" onclick="downloadAnalysisSummary()">Download Summary CSV</button>
                </div>

                <div class="panel analysis-results-panel">
                    <h3>Detailed Results</h3>
                    <div id="analysisDetails" class="analysis-details-scroll"></div>
                    <button class="btn btn-success analysis-download-btn" onclick="downloadAnalysisDetails()">Download Details CSV</button>
                </div>
            </div>
        </section>

        <!-- Screen: Dictionary Analysis -->
        <section id="screen-dictionary" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <select id="dictionarySelectorDict" class="dictionary-selector-title" onchange="onDictionaryChange()">
                        <option value="">Loading dictionaries...</option>
                    </select>
                </div>
            </div>

            <div class="dictionary-grid">
                <!-- Left Column: Letter Frequency (full height) -->
                <div class="dictionary-col dictionary-col-left">
                    <div class="panel dictionary-panel dictionary-panel-grow">
                        <h3>Letter Frequency by Position</h3>
                        <div class="dictionary-freq-scroll" id="dictionaryLetterFrequency">
                            <p class="muted-center muted-small">No data loaded.</p>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Complexity Distribution (top) + Words (bottom) -->
                <div class="dictionary-col dictionary-col-right">
                    <div class="panel dictionary-panel">
                        <h3>Complexity Distribution</h3>
                        <div id="dictionaryComplexityDistribution" class="dictionary-distribution">
                            <p class="muted-center muted-small">No data loaded.</p>
                        </div>
                    </div>

                    <div class="panel dictionary-panel dictionary-panel-grow">
                        <div class="dictionary-words-header">
                            <h3>Words</h3>
                            <input type="text" id="dictionaryWordsSearch" class="form-input search-input-compact" placeholder="Search words..." oninput="filterDictionaryWords()">
                        </div>
                        <div class="dictionary-words-scroll" id="dictionaryWords">
                            <p class="muted-center muted-small">No dictionary selected.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Screen: Admin -->
        <section id="screen-admin" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Admin</h2>
                    <div class="screen-subtitle" id="adminSubtitle">User Management</div>
                </div>
                <div class="screen-toolbar-right">
                    <button class="btn btn-secondary" onclick="refreshAdminUsers()">Refresh</button>
                    <button class="btn btn-secondary" onclick="checkHealth()">Server Status</button>
                </div>
            </div>

            <!-- Not authorised message (shown to non-admins) -->
            <div id="adminNoAccess" class="panel placeholder-panel" style="display: none;">
                <h3>Access Denied</h3>
                <p>You must be signed in with an administrator account to access this page.</p>
            </div>

            <!-- Admin content (shown to admins) -->
            <div id="adminContent" style="display: none;">
                <!-- User list table -->
                <div class="panel admin-panel">
                    <div class="admin-table-wrap">
                        <table class="admin-table" id="adminUserTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Full Name</th>
                                    <th>Provider</th>
                                    <th>Roles</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminUserTableBody">
                                <tr><td colspan="8" class="admin-table-empty">Loading users...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Role modal -->
            <div id="roleModal" class="admin-modal-overlay" style="display: none;">
                <div class="admin-modal">
                    <div class="admin-modal-header">
                        <h3 id="roleModalTitle">Manage Roles</h3>
                        <button class="admin-modal-close" onclick="closeRoleModal()">&times;</button>
                    </div>
                    <div class="admin-modal-body">
                        <div id="roleModalCurrentRoles" class="admin-role-list"></div>
                        <div class="admin-role-add">
                            <select id="roleModalSelect" class="admin-select">
                                <option value="">Add a role...</option>
                                <option value="ADMIN">ADMIN</option>
                                <option value="MODERATOR">MODERATOR</option>
                            </select>
                            <button class="btn btn-success btn-sm" onclick="addSelectedRole()">Add</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Password reset modal -->
            <div id="passwordModal" class="admin-modal-overlay" style="display: none;">
                <div class="admin-modal">
                    <div class="admin-modal-header">
                        <h3 id="passwordModalTitle">Reset Password</h3>
                        <button class="admin-modal-close" onclick="closePasswordModal()">&times;</button>
                    </div>
                    <div class="admin-modal-body">
                        <div class="admin-form-group">
                            <label for="newPasswordInput">New Password</label>
                            <input type="password" id="newPasswordInput" class="admin-input" placeholder="Minimum 8 characters" minlength="8" autocomplete="new-password">
                        </div>
                        <div class="admin-form-group">
                            <label for="confirmPasswordInput">Confirm Password</label>
                            <input type="password" id="confirmPasswordInput" class="admin-input" placeholder="Re-enter password" autocomplete="new-password">
                        </div>
                        <div id="passwordModalError" class="admin-modal-error" style="display: none;"></div>
                        <button class="btn btn-success" onclick="submitPasswordReset()" style="width: 100%;">Reset Password</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Screen: Help -->
        <section id="screen-help" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">User Guide</h2>
                    <div class="screen-subtitle">Learn how to use WordAI</div>
                </div>
                <div class="screen-toolbar-right">
                    <a href="/help.html" target="_blank" class="btn btn-secondary">Open in New Tab</a>
                </div>
            </div>
            <div class="panel">
                <div id="helpContent" class="help-content" style="padding: 2rem;">
                    <p>Loading help content...</p>
                </div>
            </div>
        </section>
    </main>

    <div class="status-bar-shell">
        <div id="status" class="status" role="status" aria-live="polite" aria-atomic="true">
            <span id="statusMessage" class="status-message"></span>
            <button type="button" id="statusDismiss" class="status-dismiss" aria-label="Clear message" onclick="hideStatus()">√ó</button>
        </div>
    </div>

    <footer class="app-footer">
        <div class="footer-content">
            <div class="footer-copyright">
                ¬© 2026 FistralTech Ltd | v1.6.1
            </div>
            <nav class="footer-links" aria-label="Footer navigation">
                <a href="https://fistraltech.com" target="_blank" rel="noopener noreferrer" class="footer-link">fistraltech.com</a>
                <a href="#/privacy" class="footer-link">Privacy Policy</a>
                <a href="#/terms" class="footer-link">Terms of Service</a>
                <a href="#/cookies" class="footer-link">Cookie Policy</a>
                <a href="#/terms-sale" class="footer-link">Terms of Sale</a>
            </nav>
        </div>
    </footer>

    <script src="js/game.js?v=20260215_2000"></script>
</body>
</html>