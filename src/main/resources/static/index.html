<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>WordAI Game - Web Interface</title>
    <style>
        /* Import Google Fonts for better typography */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;600&display=swap');
        
        :root {
            /* Color Palette - Slate Gray & Blue Theme */
            --primary-dark: #263238;
            --primary-slate: #37474f;
            --primary-gray: #455a64;
            --accent-blue: #2196f3;
            --accent-blue-light: #42a5f5;
            --accent-blue-lighter: #64b5f6;
            
            /* Functional Colors */
            --success-green: #4caf50;
            --warning-amber: #ff9800;
            --error-red: #f44336;
            --info-cyan: #00bcd4;
            
            /* Neutral Colors */
            --white: #ffffff;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-900: #212121;
            
            /* Panel Colors */
            --panel-bg: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            --panel-border: rgba(33, 150, 243, 0.15);
            --panel-shadow: 0 8px 32px rgba(33, 150, 243, 0.12);
            
            /* Typography */
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-mono: 'JetBrains Mono', 'Courier New', monospace;
        }
        
        body {
            font-family: var(--font-main);
            margin: 0 auto;
            padding: 10px;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-slate) 100%);
            min-height: 110vh;
            max-width: 1600px;
            color: var(--gray-900);
            font-size: 14px;
            line-height: 1.5;
        }
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
            max-width: 1210px;
        }
        
        .header-title {
            text-align: left;
            color: var(--white);
            font-size: 2.5em;
            font-weight: 800;
            text-shadow: 0 4px 12px rgba(0,0,0,0.3);
            margin: 0;
            letter-spacing: -0.5px;
        }
        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .dictionary-selector {
            padding: 10px 16px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.25);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            font-family: var(--font-main);
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .dictionary-selector:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .dictionary-selector option {
            background: #e0e0e0;
            color: var(--primary-dark);
            padding: 8px;
            font-family: var(--font-main);
        }
        
        .dictionary-selector option:disabled {
            color: #999;
            font-style: italic;
        }
        .main-layout {
            display: flex;
            gap: 10px;
            align-items: stretch;
        }
        .game-container {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--panel-shadow);
            border: 1px solid var(--panel-border);
            width: 380px;
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .game-container h3 {
            margin-top: 0;
            margin-bottom: 14px;
            color: var(--primary-slate);
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 8px;
            font-size: 1.1em;
            font-weight: 700;
            text-shadow: none;
            letter-spacing: -0.3px;
        }
        
        .game-info {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
        }
        .info-panel {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--panel-shadow);
            border: 1px solid var(--panel-border);
            width: 260px;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
        }
        
        .info-panel h3 {
            margin-top: 0;
            margin-bottom: 14px;
            color: var(--primary-slate);
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 8px;
            font-size: 1.1em;
            font-weight: 700;
            text-shadow: none;
            letter-spacing: -0.3px;
        }
        .assistant-panel {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--panel-shadow);
            border: 1px solid var(--panel-border);
            width: 300px;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
        }
        
        .assistant-panel h3 {
            margin-top: 0;
            margin-bottom: 14px;
            color: var(--primary-slate);
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 8px;
            font-size: 1.1em;
            font-weight: 700;
            text-shadow: none;
            letter-spacing: -0.3px;
        }
        .assistant-content {
            background: rgba(33, 150, 243, 0.06);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid rgba(33, 150, 243, 0.15);
            font-size: 0.9em;
            line-height: 1.6;
            color: var(--gray-700);
        }
        .hint-section {
            background: rgba(33, 150, 243, 0.06);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .hint-label {
            font-weight: 700;
            color: var(--primary-slate);
            margin-bottom: 6px;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }
        
        .hint-value {
            color: var(--gray-700);
            font-size: 0.95em;
            line-height: 1.6;
        }
        .history-panel {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--panel-shadow);
            border: 1px solid var(--panel-border);
            width: 260px;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .history-panel h3 {
            margin-top: 0;
            margin-bottom: 14px;
            color: var(--primary-slate);
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 8px;
            font-size: 1.1em;
            font-weight: 700;
            text-shadow: none;
            letter-spacing: -0.3px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 6px;
            margin-bottom: 10px;
        }
        .win-rate-stat {
            background: rgba(33, 150, 243, 0.1);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 12px;
            border: 2px solid var(--accent-blue-light);
        }
        
        .win-rate-label {
            font-size: 0.75em;
            color: var(--primary-slate);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 4px;
        }
        
        .win-rate-value {
            font-size: 1.8em;
            color: var(--accent-blue);
            font-weight: 800;
            font-family: var(--font-mono);
        }
        .stat-item {
            background: rgba(33, 150, 243, 0.06);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid rgba(33, 150, 243, 0.15);
        }
        
        .stat-label {
            font-size: 0.7em;
            color: var(--primary-slate);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-size: 1.4em;
            color: var(--accent-blue);
            font-weight: 800;
            font-family: var(--font-mono);
        }
        .game-history {
            flex: 1;
            overflow-y: hidden;
            max-height: 300px;
        }
        .history-item {
            background: rgba(33, 150, 243, 0.05);
            padding: 8px 10px;
            border-radius: 6px;
            margin-bottom: 6px;
            border: 1px solid rgba(33, 150, 243, 0.12);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        
        .history-item:hover {
            background: rgba(33, 150, 243, 0.1);
            transform: translateX(2px);
        }
        
        .history-word {
            font-size: 0.95em;
            font-weight: 700;
            color: var(--primary-slate);
            flex: 0 0 auto;
            min-width: 60px;
            font-family: var(--font-mono);
        }
        
        .history-attempts {
            font-size: 0.8em;
            color: var(--gray-600);
            flex: 1;
            text-align: center;
            font-weight: 500;
        }
        .history-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.7em;
            flex: 0 0 auto;
            min-width: 50px;
            text-align: center;
            letter-spacing: 0.3px;
        }
        
        .history-won {
            background: var(--success-green);
            color: white;
        }
        
        .history-lost {
            background: var(--error-red);
            color: white;
        }
        .info-section {
            margin-bottom: 14px;
            background: rgba(33, 150, 243, 0.05);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(33, 150, 243, 0.12);
        }
        
        .info-label {
            font-weight: 700;
            color: var(--primary-slate);
            margin-bottom: 6px;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }
        
        .info-value {
            font-size: 1.5em;
            color: var(--accent-blue);
            font-weight: 800;
            font-family: var(--font-mono);
            text-shadow: none;
        }
        .remaining-words {
            background: rgba(33, 150, 243, 0.06);
            border-radius: 8px;
            padding: 12px;
            margin-top: auto;
            border: 1px solid rgba(33, 150, 243, 0.15);
            backdrop-filter: blur(5px);
        }
        .container {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        h1 {
            text-align: left;
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 1.8em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .game-info {
            display: flex;
            justify-content: center;
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(33, 150, 243, 0.08);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15);
            border: 1px solid rgba(33, 150, 243, 0.2);
            font-weight: 600;
            font-size: 0.95em;
            color: var(--primary-slate);
        }
        .guess-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .letter-inputs {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        .letter-input {
            width: 45px;
            height: 45px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-size: 20px;
            font-weight: 700;
            font-family: var(--font-mono);
            text-align: center;
            text-transform: uppercase;
            outline: none;
            transition: all 0.3s ease;
            background: var(--white);
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }
        
        .letter-input:focus {
            border-color: var(--accent-blue-light);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.25);
            transform: translateY(-2px);
        }
        
        .letter-input.filled {
            background: rgba(33, 150, 243, 0.08);
            border-color: var(--accent-blue);
            color: var(--primary-slate);
        }
        
        .letter-input:disabled {
            background: var(--gray-100);
            color: var(--gray-600);
            cursor: not-allowed;
        }
        #guessBtn {
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-light) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            font-family: var(--font-main);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        #guessBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.6);
        }
        
        #guessBtn:disabled {
            background: linear-gradient(135deg, var(--gray-600), var(--gray-700));
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 10px rgba(117, 117, 117, 0.3);
        }
        
        #guessBtn:active:not(:disabled) {
            transform: translateY(0);
        }
        .guess-history {
            margin-top: 10px;
            min-height: 330px;
            max-height: 330px;
            overflow-y: hidden;
        }
        .guess-row {
            display: flex;
            gap: 5px;
            margin-bottom: 6px;
            justify-content: center;
        }
        .letter-box {
            width: 45px;
            height: 45px;
            border: 2px solid var(--gray-300);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            font-family: var(--font-mono);
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .letter-correct {
            background: linear-gradient(135deg, #6aaa64, #5d9956);
            color: white;
            border-color: #6aaa64;
            box-shadow: 0 4px 8px rgba(106, 170, 100, 0.4);
        }
        .letter-present {
            background: linear-gradient(135deg, #c9b458, #b8a147);
            color: white;
            border-color: #c9b458;
            box-shadow: 0 4px 8px rgba(201, 180, 88, 0.4);
        }
        .letter-absent {
            background: linear-gradient(135deg, #787c7e, #6a6e70);
            color: white;
            border-color: #787c7e;
            box-shadow: 0 4px 8px rgba(120, 124, 126, 0.4);
        }
        .status {
            text-align: center;
            padding: 12px 16px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            font-weight: 600;
            font-size: 0.95em;
            margin: 0 0 12px 0;
            font-family: var(--font-main);
        }
        
        .status.success {
            background: rgba(76, 175, 80, 0.15);
            color: #2e7d32;
            border-color: rgba(76, 175, 80, 0.3);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
        }
        
        .status.error {
            background: rgba(244, 67, 54, 0.15);
            color: #c62828;
            border-color: rgba(244, 67, 54, 0.3);
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.2);
        }
        
        .status.info {
            background: rgba(0, 188, 212, 0.15);
            color: #00838f;
            border-color: rgba(0, 188, 212, 0.3);
            box-shadow: 0 4px 15px rgba(0, 188, 212, 0.2);
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }
        .btn {
            padding: 10px 20px;
            margin: 0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 700;
            font-family: var(--font-main);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--gray-600), var(--gray-700));
            color: white;
            box-shadow: 0 4px 15px rgba(117, 117, 117, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-green), #43a047);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        .win-rate-display {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.9);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
            font-weight: bold;
            color: #6a1b9a;
        }
        .server-status-bottom {
            margin-top: auto;
            padding-top: 10px;
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <h1 class="header-title"><span style="color: #ffffff !important;">üìù</span> WordAI Game</h1>
        <div class="header-actions">
            <select id="dictionarySelector" class="dictionary-selector" onchange="onDictionaryChange()">
                <option value="">Loading dictionaries...</option>
            </select>
            <button class="btn btn-success" onclick="newGame()">New Game</button>
            <button class="btn btn-secondary" onclick="checkHealth()">Server Status</button>
        </div>
    </div>
    
    <div class="main-layout">
        <!-- Game History Panel -->
        <div class="history-panel">
            <h3>üìä Session Stats</h3>
            <div class="win-rate-stat">
                <div class="win-rate-label">Win Rate</div>
                <div class="win-rate-value" id="stat-winrate">0%</div>
            </div>
            <div class="stats-grid">
                <!-- Row 1: Total, Won, Lost -->
                <div class="stat-item">
                    <div class="stat-label">Total</div>
                    <div class="stat-value" id="stat-total">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Won</div>
                    <div class="stat-value" id="stat-won">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Lost</div>
                    <div class="stat-value" id="stat-lost">0</div>
                </div>
                <!-- Row 2: Min, Max, Avg -->
                <div class="stat-item">
                    <div class="stat-label">Min</div>
                    <div class="stat-value" id="stat-min">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Max</div>
                    <div class="stat-value" id="stat-max">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Avg</div>
                    <div class="stat-value" id="stat-avg">-</div>
                </div>
            </div>
            
            <h3>üïê Recent Games</h3>
            <div class="game-history" id="game-history">
                <p style="text-align: center; color: #888; padding: 20px;">No games played yet</p>
            </div>
            
            <h3>üéØ Quick Stats</h3>
            <div class="hint-value" id="assistant-stats" style="padding: 15px; background: #f5f5f5; border-radius: 8px; margin-top: 10px;">
                No active game
            </div>
        </div>
        
        <div class="game-container">
            <h3>üìù Game</h3>
            
            <div id="status" class="status" style="display:none;"></div>
            
            <div class="game-info">
                <div>Attempts: <span id="attempts">0</span>/<span id="maxAttempts">6</span></div>
            </div>
            
            <div class="guess-container">
                <div class="letter-inputs" id="letterInputs">
                    <!-- Letter inputs will be dynamically generated based on selected dictionary -->
                </div>
                <button id="guessBtn" onclick="makeGuess()">Make Guess</button>
            </div>
            
            <div class="guess-history" id="guessHistory"></div>
        </div>
        
        <!-- Game Assistant Panel -->
        <div class="assistant-panel">
            <h3>üí° Game Assistant</h3>
            
            <div class="assistant-content">
                <p style="margin: 0 0 10px 0; color: #666; font-size: 0.85em;">
                    Get AI-powered word suggestions to help you win!
                </p>
            </div>
            
            <div class="hint-section">
                <div class="hint-label">Strategy Selection</div>
                <div class="hint-value">
                    <select id="strategySelector" onchange="changeStrategy()" style="width: 100%; padding: 8px; border-radius: 6px; border: 2px solid var(--accent-blue-lighter); font-family: var(--font-main); font-weight: 600; background: white; color: var(--primary-slate); cursor: pointer; font-size: 0.9em;">
                        <option value="RANDOM">Random Selection</option>
                        <option value="ENTROPY">Maximum Entropy</option>
                    </select>
                </div>
            </div>
            
            <div class="hint-section">
                <div class="hint-label">üí≠ Suggested Word</div>
                <div class="hint-value" id="suggestedWord" style="font-size: 1.3em; font-weight: 800; color: var(--accent-blue); text-transform: uppercase; letter-spacing: 2px; font-family: var(--font-mono);">
                    Click "Get Suggestion"
                </div>
                <button onclick="getSuggestion()" style="width: 100%; margin-top: 8px; padding: 10px; background: linear-gradient(135deg, var(--success-green), #43a047); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; font-family: var(--font-main); text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.85em; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(76, 175, 80, 0.6)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(76, 175, 80, 0.4)';">
                    Get Suggestion
                </button>
            </div>
            
            <div class="hint-section">
                <div class="hint-label">Strategy Tips</div>
                <div class="hint-value" id="strategyTips">
                    <strong>Random:</strong> Selects words randomly from valid options. Simple but effective!
                </div>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>üìä Game Analytics</h3>
            
            <div class="info-section">
                <div class="info-label">Total Dictionary Words:</div>
                <div class="info-value" id="totalWords">2315</div>
            </div>
            
            <div class="info-section">
                <div class="info-label">Remaining Valid Words:</div>
                <div class="info-value" id="remainingWords">2315</div>
            </div>
            
            <div class="info-section">
                <div class="info-label">Words Eliminated:</div>
                <div class="info-value" id="eliminatedWords">0</div>
            </div>
            
            <div class="info-section">
                <div class="info-label">Reduction %:</div>
                <div class="info-value" id="reductionPercent">0%</div>
            </div>
            
            <hr style="border: none; border-top: 1px solid #ddd; margin: 15px 0;">
            
            <div class="info-section">
                <div class="info-label">Unique Letters Remaining:</div>
                <div class="info-value" id="uniqueLetters">26</div>
            </div>
            
            <div class="info-section">
                <div class="info-label">Total Letter Count:</div>
                <div class="info-value" id="letterCount">-</div>
            </div>
            
            <div class="info-section">
                <div class="info-label">Column Lengths:</div>
                <div id="columnLengthsChart" style="display: flex; align-items: flex-end; gap: 8px; height: 130px; padding: 10px; background: rgba(255,255,255,0.3); border-radius: 6px; margin-top: 8px;">
                    <!-- Bar chart will be dynamically generated here -->
                </div>
            </div>
            
            <div class="remaining-words">
                <div class="info-label">After Last Guess:</div>
                <div id="lastGuessInfo" style="font-size: 14px; color: #666; margin-top: 5px;">
                    Start guessing to see word reduction analytics!
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/wordai';
        let currentGameId = null;
        let gameEnded = false;
        let currentWordLength = 5; // Track the current game's word length
        let currentDictionarySize = 2315; // Track the current dictionary's total word count

        // Initialize page
        window.addEventListener('DOMContentLoaded', function() {
            newGame();
            updateHistoryDisplay();
            updateStats();
        });

        function setupLetterInputs() {
            const inputs = document.querySelectorAll('.letter-input');
            
            inputs.forEach((input, index) => {
                // Handle typing in each input
                input.addEventListener('input', function(e) {
                    const value = e.target.value.toUpperCase();
                    e.target.value = value;
                    
                    // Add visual feedback for filled inputs
                    if (value) {
                        e.target.classList.add('filled');
                        // Auto-focus next input
                        if (index < inputs.length - 1) {
                            inputs[index + 1].focus();
                        }
                    } else {
                        e.target.classList.remove('filled');
                    }
                });

                // Handle backspace to move to previous input
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && !e.target.value && index > 0) {
                        inputs[index - 1].focus();
                        inputs[index - 1].value = '';
                        inputs[index - 1].classList.remove('filled');
                    }
                    
                    // Handle Enter key to submit guess
                    if (e.key === 'Enter' && !gameEnded) {
                        makeGuess();
                    }
                });

                // Prevent non-letter characters
                input.addEventListener('keypress', function(e) {
                    const char = String.fromCharCode(e.which);
                    if (!/[a-zA-Z]/.test(char)) {
                        e.preventDefault();
                    }
                });
            });
        }

        function getCurrentGuess() {
            const inputs = document.querySelectorAll('.letter-input');
            let word = '';
            inputs.forEach(input => {
                word += input.value.toUpperCase();
            });
            return word;
        }

        function clearLetterInputs() {
            const inputs = document.querySelectorAll('.letter-input');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('filled');
                input.disabled = false;
            });
            if (inputs.length > 0) {
                inputs[0].focus();
            }
        }

        function disableLetterInputs() {
            const inputs = document.querySelectorAll('.letter-input');
            inputs.forEach(input => {
                input.disabled = true;
            });
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
        }

        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }

        async function newGame() {
            try {
                hideStatus();
                
                // Delete the previous game session if one exists
                if (currentGameId) {
                    try {
                        await fetch(`${API_BASE}/games/${currentGameId}`, {
                            method: 'DELETE'
                        });
                        console.log('Deleted previous game session:', currentGameId);
                    } catch (deleteError) {
                        console.warn('Failed to delete previous session:', deleteError);
                        // Continue anyway - don't block new game creation
                    }
                }
                
                // Get the selected dictionary ID
                const selector = document.getElementById('dictionarySelector');
                const dictionaryId = selector.value || null;
                
                const requestBody = dictionaryId ? { dictionaryId: dictionaryId } : {};
                
                const response = await fetch(`${API_BASE}/games`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                currentGameId = data.gameId;
                currentWordLength = data.wordLength; // Store the word length for this game
                gameEnded = false;
                
                document.getElementById('attempts').textContent = '0';
                document.getElementById('maxAttempts').textContent = data.maxAttempts;
                document.getElementById('guessHistory').innerHTML = '';
                clearLetterInputs();
                document.getElementById('guessBtn').disabled = false;
                
                // Initialize analytics panel with initial dictionary metrics
                if (data.dictionaryMetrics) {
                    initializeAnalytics(data.dictionaryMetrics);
                } else {
                    resetAnalytics();
                }
                
                // Update assistant panel
                updateAssistant('new');
                
                // Set the strategy for the new game based on dropdown selection
                await changeStrategy();
                
                showStatus('New game started! Start guessing!', 'success');
            } catch (error) {
                showStatus('Failed to create new game: ' + error.message, 'error');
            }
        }

        async function makeGuess() {
            if (!currentGameId || gameEnded) {
                return;
            }

            const word = getCurrentGuess().trim();
            if (!word) {
                showStatus('Please enter a word!', 'error');
                return;
            }

            if (word.length !== currentWordLength) {
                showStatus(`Word must be ${currentWordLength} letters long!`, 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/games/${currentGameId}/guess`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ word: word })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `HTTP error! status: ${response.status}`);
                }

                // Update game info
                document.getElementById('attempts').textContent = data.attemptNumber;
                
                // Update analytics if remaining words count is available
                if (data.remainingWordsCount !== undefined) {
                    updateAnalytics(word, data.remainingWordsCount, data.dictionaryMetrics);
                }
                
                // Add guess to history
                addGuessToHistory(word, data.results);
                
                // Clear inputs
                clearLetterInputs();
                
                // Check game status
                if (data.gameWon) {
                    gameEnded = true;
                    disableLetterInputs();
                    document.getElementById('guessBtn').disabled = true;
                    showStatus('üéâ Congratulations! You won!', 'success');
                    updateAssistant('won', data.attemptNumber);
                    // Save game result
                    saveGameResult(word, data.attemptNumber, true);
                } else if (data.gameOver) {
                    gameEnded = true;
                    disableLetterInputs();
                    document.getElementById('guessBtn').disabled = true;
                    showStatus('üíî Game Over! Better luck next time!', 'error');
                    updateAssistant('lost', data.attemptNumber);
                    // Fetch game status to get target word
                    fetchTargetWordAndSave(data.attemptNumber);
                } else {
                    showStatus(`Keep going! ${data.maxAttempts - data.attemptNumber} attempts left.`, 'info');
                    updateAssistant('playing', data.attemptNumber, data.remainingWordsCount);
                }

            } catch (error) {
                showStatus('Error making guess: ' + error.message, 'error');
            }
        }

        function addGuessToHistory(word, results) {
            const historyDiv = document.getElementById('guessHistory');
            const guessRow = document.createElement('div');
            guessRow.className = 'guess-row';

            for (let i = 0; i < results.length; i++) {
                const letterBox = document.createElement('div');
                letterBox.className = 'letter-box';
                letterBox.textContent = results[i].letter;
                
                switch (results[i].status) {
                    case 'G':
                        letterBox.classList.add('letter-correct');
                        break;
                    case 'A':
                        letterBox.classList.add('letter-present');
                        break;
                    case 'R':
                    case 'X':  // eXcess letters display the same as Red (absent)
                        letterBox.classList.add('letter-absent');
                        break;
                }
                
                guessRow.appendChild(letterBox);
            }

            historyDiv.appendChild(guessRow);
        }

        async function checkHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    showStatus(`Server is running! Active sessions: ${data.activeSessions}`, 'success');
                } else {
                    showStatus('Server health check failed', 'error');
                }
            } catch (error) {
                showStatus('Cannot connect to server: ' + error.message, 'error');
            }
        }

        function initializeAnalytics(dictionaryMetrics) {
            // Get total words from the server response
            const totalWords = dictionaryMetrics.totalWords || 2315;
            currentDictionarySize = totalWords; // Store for later use
            
            document.getElementById('totalWords').textContent = totalWords;
            document.getElementById('remainingWords').textContent = totalWords;
            document.getElementById('eliminatedWords').textContent = '0';
            document.getElementById('reductionPercent').textContent = '0%';
            
            // Populate dictionary metrics from server response
            document.getElementById('uniqueLetters').textContent = dictionaryMetrics.uniqueCharacters || '26';
            document.getElementById('letterCount').textContent = dictionaryMetrics.letterCount || '-';
            
            // Update column lengths bar chart with initial data
            if (dictionaryMetrics.columnLengths && dictionaryMetrics.columnLengths.length > 0) {
                updateColumnLengthsChart(dictionaryMetrics.columnLengths);
            } else {
                updateColumnLengthsChart(null);
            }
            
            document.getElementById('lastGuessInfo').textContent = 'Start guessing to see word reduction analytics!';
        }

        function resetAnalytics() {
            const totalWords = currentDictionarySize; // Use current dictionary size
            document.getElementById('totalWords').textContent = totalWords;
            document.getElementById('remainingWords').textContent = totalWords;
            document.getElementById('eliminatedWords').textContent = '0';
            document.getElementById('reductionPercent').textContent = '0%';
            document.getElementById('uniqueLetters').textContent = '26';
            document.getElementById('letterCount').textContent = '-';
            updateColumnLengthsChart(null);
            document.getElementById('lastGuessInfo').textContent = 'Start guessing to see word reduction analytics!';
        }

        function updateAnalytics(guessedWord, remainingCount, dictionaryMetrics) {
            const totalWords = currentDictionarySize;
            const eliminated = totalWords - remainingCount;
            const reductionPercent = ((eliminated / totalWords) * 100).toFixed(2);
            
            document.getElementById('remainingWords').textContent = remainingCount;
            document.getElementById('eliminatedWords').textContent = eliminated;
            document.getElementById('reductionPercent').textContent = reductionPercent + '%';
            document.getElementById('lastGuessInfo').textContent = 
                `After "${guessedWord}": ${remainingCount} words remain (${eliminated} eliminated)`;
            
            // Update dictionary metrics if available
            if (dictionaryMetrics) {
                document.getElementById('uniqueLetters').textContent = dictionaryMetrics.uniqueCharacters || '-';
                document.getElementById('letterCount').textContent = dictionaryMetrics.letterCount || '-';
                
                // Update column lengths bar chart
                if (dictionaryMetrics.columnLengths && dictionaryMetrics.columnLengths.length > 0) {
                    updateColumnLengthsChart(dictionaryMetrics.columnLengths);
                } else {
                    updateColumnLengthsChart(null);
                }
            }
        }

        function updateColumnLengthsChart(columnLengths) {
            const chartContainer = document.getElementById('columnLengthsChart');
            chartContainer.innerHTML = '';
            
            if (!columnLengths || columnLengths.length === 0) {
                chartContainer.innerHTML = '<div style="width: 100%; text-align: center; color: #888; align-self: center;">No data yet</div>';
                return;
            }
            
            const maxHeight = 26; // Maximum possible unique letters per position
            const chartHeight = 100; // Height of chart area in pixels
            
            columnLengths.forEach((count, index) => {
                const barContainer = document.createElement('div');
                barContainer.style.cssText = 'flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px;';
                
                // Create bar wrapper for positioning
                const barWrapper = document.createElement('div');
                barWrapper.style.cssText = `height: ${chartHeight}px; display: flex; align-items: flex-end; justify-content: center; width: 100%;`;
                
                // Calculate bar height as percentage of max (26)
                const heightPercent = (count / maxHeight) * 100;
                const barHeight = (heightPercent / 100) * chartHeight;
                
                // Create the bar
                const bar = document.createElement('div');
                bar.style.cssText = `
                    width: 100%;
                    height: ${barHeight}px;
                    background: linear-gradient(180deg, var(--accent-blue-light) 0%, var(--accent-blue) 100%);
                    border-radius: 4px 4px 0 0;
                    transition: all 0.3s ease;
                    box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
                    position: relative;
                `;
                
                // Add count label on top of bar
                const countLabel = document.createElement('div');
                countLabel.style.cssText = `
                    position: absolute;
                    top: -20px;
                    left: 50%;
                    transform: translateX(-50%);
                    font-size: 0.75em;
                    font-weight: 700;
                    color: var(--primary-slate);
                    white-space: nowrap;
                `;
                countLabel.textContent = count;
                bar.appendChild(countLabel);
                
                barWrapper.appendChild(bar);
                barContainer.appendChild(barWrapper);
                
                // Add position label below bar
                const label = document.createElement('div');
                label.style.cssText = 'font-size: 0.7em; color: #666; font-weight: bold;';
                label.textContent = `P${index + 1}`;
                barContainer.appendChild(label);
                
                chartContainer.appendChild(barContainer);
            });
        }

        function updateAssistant(status, attempts = 0, remainingWords = 0) {
            const statsDiv = document.getElementById('assistant-stats');
            
            if (status === 'new') {
                statsDiv.innerHTML = `
                    <div style="color: #2e7d32; font-weight: bold;">üìù New game started!</div>
                    <div style="margin-top: 5px; font-size: 0.85em;">Attempts: 0/6</div>
                    <div style="font-size: 0.85em;">Good luck!</div>
                `;
            } else if (status === 'playing') {
                const maxAttempts = document.getElementById('maxAttempts').textContent;
                const remaining = parseInt(maxAttempts) - attempts;
                statsDiv.innerHTML = `
                    <div style="font-weight: bold;">üìù Attempt ${attempts}/${maxAttempts}</div>
                    <div style="margin-top: 5px; font-size: 0.85em;">${remaining} attempts remaining</div>
                    <div style="font-size: 0.85em; color: #1976d2;">${remainingWords} possible words</div>
                `;
            } else if (status === 'won') {
                statsDiv.innerHTML = `
                    <div style="color: #2e7d32; font-weight: bold;">üéâ Victory!</div>
                    <div style="margin-top: 5px; font-size: 0.85em;">Solved in ${attempts} attempt${attempts > 1 ? 's' : ''}!</div>
                    <div style="font-size: 0.85em;">Great job!</div>
                `;
            } else if (status === 'lost') {
                statsDiv.innerHTML = `
                    <div style="color: #c62828; font-weight: bold;">üíî Game Over</div>
                    <div style="margin-top: 5px; font-size: 0.85em;">Used all ${attempts} attempts</div>
                    <div style="font-size: 0.85em;">Try again!</div>
                `;
            }
        }

        // Game History Management
        async function fetchTargetWordAndSave(attempts) {
            try {
                const response = await fetch(`${API_BASE}/games/${currentGameId}`);
                const data = await response.json();
                // Use a placeholder if target word is not available
                const targetWord = data.targetWord || '?????';
                saveGameResult(targetWord, attempts, false);
            } catch (error) {
                console.error('Failed to fetch target word:', error);
                // Still save the game as lost even if we can't get the target word
                saveGameResult('?????', attempts, false);
            }
        }

        function getGameHistory() {
            const history = sessionStorage.getItem('gameHistory');
            return history ? JSON.parse(history) : [];
        }

        function getGameStats() {
            const stats = sessionStorage.getItem('gameStats');
            return stats ? JSON.parse(stats) : { total: 0, won: 0, lost: 0, wonGames: [] };
        }

        function saveGameResult(targetWord, attempts, won) {
            // Save to limited history (for display)
            const history = getGameHistory();
            history.unshift({
                targetWord: targetWord,
                attempts: attempts,
                won: won,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 10 games in history (for display)
            if (history.length > 10) {
                history.length = 10;
            }
            sessionStorage.setItem('gameHistory', JSON.stringify(history));
            
            // Update cumulative stats (not limited)
            const stats = getGameStats();
            stats.total++;
            if (won) {
                stats.won++;
                stats.wonGames.push(attempts);
            } else {
                stats.lost++;
            }
            sessionStorage.setItem('gameStats', JSON.stringify(stats));
            
            updateHistoryDisplay();
            updateStats();
        }

        function updateHistoryDisplay() {
            const history = getGameHistory();
            const historyContainer = document.getElementById('game-history');
            
            if (history.length === 0) {
                historyContainer.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">No games played yet</p>';
                return;
            }
            
            // Display only last 5 games
            const recentGames = history.slice(0, 5);
            historyContainer.innerHTML = recentGames.map(game => `
                <div class="history-item">
                    <div class="history-word">${game.targetWord.toUpperCase()}</div>
                    <div class="history-attempts">${game.attempts} attempt${game.attempts !== 1 ? 's' : ''}</div>
                    <span class="history-status ${game.won ? 'history-won' : 'history-lost'}">
                        ${game.won ? '‚úì WON' : '‚úó LOST'}
                    </span>
                </div>
            `).join('');
        }

        function updateStats() {
            const stats = getGameStats();
            
            if (stats.total === 0) {
                document.getElementById('stat-total').textContent = '0';
                document.getElementById('stat-won').textContent = '0';
                document.getElementById('stat-lost').textContent = '0';
                document.getElementById('stat-winrate').textContent = '0%';
                document.getElementById('stat-min').textContent = '-';
                document.getElementById('stat-max').textContent = '-';
                document.getElementById('stat-avg').textContent = '-';
                return;
            }
            
            const total = stats.total;
            const won = stats.won;
            const lost = stats.lost;
            const winRate = Math.round((won / total) * 100);
            
            // Calculate min, max, avg from won games
            let minGuesses = '-';
            let maxGuesses = '-';
            let avgGuesses = '-';
            
            if (stats.wonGames.length > 0) {
                minGuesses = Math.min(...stats.wonGames);
                maxGuesses = Math.max(...stats.wonGames);
                const sum = stats.wonGames.reduce((a, b) => a + b, 0);
                avgGuesses = (sum / stats.wonGames.length).toFixed(1);
            }
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-won').textContent = won;
            document.getElementById('stat-lost').textContent = lost;
            document.getElementById('stat-winrate').textContent = winRate + '%';
            document.getElementById('stat-min').textContent = minGuesses;
            document.getElementById('stat-max').textContent = maxGuesses;
            document.getElementById('stat-avg').textContent = avgGuesses;
        }

        // Strategy and Suggestion Functions
        async function changeStrategy() {
            if (!currentGameId) {
                showStatus('No active game', 'error');
                return;
            }

            const strategy = document.getElementById('strategySelector').value;
            
            try {
                const response = await fetch(`${API_BASE}/games/${currentGameId}/strategy`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ strategy: strategy })
                });

                if (response.ok) {
                    updateStrategyTips(strategy);
                    showStatus(`Strategy changed to ${strategy}`, 'success');
                } else {
                    showStatus('Failed to change strategy', 'error');
                }
            } catch (error) {
                showStatus('Error changing strategy: ' + error.message, 'error');
            }
        }

        async function getSuggestion() {
            if (!currentGameId) {
                showStatus('No active game', 'error');
                return;
            }

            if (gameEnded) {
                showStatus('Game has ended', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/games/${currentGameId}/suggestion`);
                const data = await response.json();

                if (response.ok && data.suggestion) {
                    document.getElementById('suggestedWord').textContent = data.suggestion.toUpperCase();
                    showStatus(`Suggestion: ${data.suggestion.toUpperCase()} (${data.strategy})`, 'success');
                } else if (response.ok && !data.suggestion) {
                    document.getElementById('suggestedWord').textContent = 'No words available';
                    showStatus('No valid words remaining', 'error');
                } else {
                    showStatus('Failed to get suggestion', 'error');
                }
            } catch (error) {
                showStatus('Error getting suggestion: ' + error.message, 'error');
            }
        }

        function updateStrategyTips(strategy) {
            const tipsDiv = document.getElementById('strategyTips');
            
            if (strategy === 'RANDOM') {
                tipsDiv.innerHTML = '<strong>Random:</strong> Selects words randomly from valid options. Simple but effective!';
            } else if (strategy === 'ENTROPY') {
                tipsDiv.innerHTML = '<strong>Maximum Entropy:</strong> Chooses words that maximize information gain. Uses statistical analysis to find the most informative guess.';
            }
        }

        // Dictionary selection functions
        let availableDictionaries = [];

        async function loadDictionaries() {
            try {
                const response = await fetch(`${API_BASE}/dictionaries`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                availableDictionaries = await response.json();
                populateDictionarySelector();
            } catch (error) {
                console.error('Failed to load dictionaries:', error);
                showStatus('Failed to load dictionaries: ' + error.message, 'error');
                
                // Fallback to default option
                const selector = document.getElementById('dictionarySelector');
                selector.innerHTML = '<option value="">Standard (5 Letters)</option>';
            }
        }

        function populateDictionarySelector() {
            const selector = document.getElementById('dictionarySelector');
            selector.innerHTML = '';

            availableDictionaries.forEach(dict => {
                const option = document.createElement('option');
                option.value = dict.id;
                option.textContent = dict.name;
                
                if (!dict.available) {
                    option.disabled = true;
                    option.textContent += ' (Not Available)';
                }
                
                if (dict.description) {
                    option.title = dict.description;
                }
                
                selector.appendChild(option);
            });

            // Select the 5-letter dictionary by default, fallback to first available
            const fiveLetterDict = availableDictionaries.find(d => d.available && d.wordLength === 5);
            const defaultDict = fiveLetterDict || availableDictionaries.find(d => d.available);
            
            if (defaultDict) {
                selector.value = defaultDict.id;
                // Adjust the letter input grid for the selected dictionary's word length
                adjustLetterInputGrid(defaultDict.wordLength);
            }
        }

        function onDictionaryChange() {
            const selector = document.getElementById('dictionarySelector');
            const selectedId = selector.value;
            const selectedDict = availableDictionaries.find(d => d.id === selectedId);
            
            if (selectedDict) {
                showStatus(`Dictionary changed to: ${selectedDict.name} (${selectedDict.wordLength} letters)`, 'success');
                
                // Adjust the letter input grid for the new word length
                adjustLetterInputGrid(selectedDict.wordLength);
            }
        }

        function adjustLetterInputGrid(wordLength) {
            const letterInputs = document.getElementById('letterInputs');
            letterInputs.innerHTML = '';

            for (let i = 0; i < wordLength; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'letter-input';
                input.maxLength = 1;
                input.id = `letter${i}`;
                
                // Add the same event handlers as before
                input.addEventListener('input', function(e) {
                    this.value = this.value.toUpperCase();
                    if (this.value && i < wordLength - 1) {
                        document.getElementById(`letter${i + 1}`).focus();
                    }
                });
                
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && !this.value && i > 0) {
                        document.getElementById(`letter${i - 1}`).focus();
                    } else if (e.key === 'Enter') {
                        makeGuess();
                    }
                });
                
                letterInputs.appendChild(input);
            }
            
            // Focus the first input
            if (wordLength > 0) {
                document.getElementById('letter0').focus();
            }
        }

        // Initialize dictionaries on page load
        loadDictionaries();
    </script>
</body>
</html>