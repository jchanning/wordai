<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>WordAI Game - Web Interface</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="header-bar">
        <div class="app-header">
            <div class="app-header-left">
                <h1 class="header-title">WordAI</h1>
                <nav class="app-nav" aria-label="Application Modes">
                    <a class="nav-link" href="#/play" data-nav="play">Play</a>
                    <a class="nav-link" href="#/bot-demo" data-nav="bot-demo">Bot Demo</a>
                    <a class="nav-link" href="#/bot-performance" data-nav="bot-performance">Bot Performance</a>
                    <a class="nav-link" href="#/dictionary" data-nav="dictionary">Dictionary</a>
                    <a class="nav-link" href="#/admin" data-nav="admin">Admin</a>
                </nav>
            </div>
            <div class="app-header-right">
                <div id="status" class="status" style="display:none;" role="status" aria-live="polite" aria-atomic="true">
                    <span id="statusMessage" class="status-message"></span>
                    <button type="button" id="statusDismiss" class="status-dismiss" aria-label="Dismiss status" onclick="hideStatus()">×</button>
                </div>
                <select id="dictionarySelector" class="dictionary-selector" onchange="onDictionaryChange()">
                    <option value="">Loading dictionaries...</option>
                </select>
            </div>
        </div>
    </div>

    <main class="app-main">
        <!-- Screen: Interactive Play -->
        <section id="screen-play" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Interactive Play</h2>
                </div>
                <div class="screen-toolbar-right">
                    <select id="strategySelector" class="form-input" style="width: auto; max-width: 200px; margin-right: 8px;" onchange="changeStrategy()">
                        <option value="RANDOM">Random Selection</option>
                        <option value="ENTROPY">Maximum Entropy</option>
                        <option value="MOST_COMMON_LETTERS">Most Common Letters</option>
                        <option value="MINIMISE_COLUMN_LENGTHS">Minimise Column Lengths</option>
                        <option value="DICTIONARY_REDUCTION">Dictionary Reduction</option>
                    </select>
                    <button id="getSuggestionBtn" class="btn btn-info" style="margin-right: 8px;" onclick="getSuggestion()">
                        Get Suggestion <span id="helpCounter" class="help-counter-inline">3/3</span>
                    </button>
                    <button class="btn btn-success" onclick="newGame()">New Game</button>
                    <button class="btn btn-danger" onclick="newSession()">New Session</button>
                    <button class="btn btn-secondary" onclick="showSessionViewer()">View Session</button>
                </div>
            </div>

            <div id="playGameHost">
            <div class="main-layout" id="gameView">
        <!-- Left Column: Game History -->
        <div class="history-panel panel play-panel">
            <h3>Session Stats</h3>
            <div class="win-rate-stat">
                <div class="win-rate-label">Win Rate</div>
                <div class="win-rate-value" id="stat-winrate">0%</div>
            </div>
            <div class="stats-grid">
                <!-- Row 1: Total, Won, Lost -->
                <div class="stat-item">
                    <div class="stat-label">Total</div>
                    <div class="stat-value" id="stat-total">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Won</div>
                    <div class="stat-value" id="stat-won">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Lost</div>
                    <div class="stat-value" id="stat-lost">0</div>
                </div>
                <!-- Row 2: Min, Max, Avg -->
                <div class="stat-item">
                    <div class="stat-label">Min</div>
                    <div class="stat-value" id="stat-min">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Max</div>
                    <div class="stat-value" id="stat-max">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Avg</div>
                    <div class="stat-value" id="stat-avg">-</div>
                </div>
            </div>
            
            <h3>Guess Distribution</h3>
            <div id="attemptsDistribution" class="surface-box surface-box-md">
                <p class="muted-center muted-small">No games played yet</p>
            </div>
            
            <h3>Recent Games</h3>
            <div class="game-history" id="game-history">
                <p class="empty-history-msg muted-center">No games played yet</p>
            </div>
        </div>
        
        <!-- Middle Column: Game Board -->
        <div class="game-container panel play-panel">
            <h3>Game</h3>
            
            <div class="game-info">
                <div>Attempts: <span id="attempts">0</span>/<span id="maxAttempts">6</span></div>
            </div>
            
            <div class="guess-container">
                <div class="letter-inputs" id="letterInputs">
                    <!-- Letter inputs will be dynamically generated based on selected dictionary -->
                </div>
                <button id="guessBtn" onclick="makeGuess()">Make Guess</button>
            </div>
            
            <div class="guess-history" id="guessHistory"></div>
        </div>
        
        <!-- Right Column: Analytics -->
        <div class="info-panel panel play-panel">
            <h3>Game Analytics</h3>
            
            <div class="analytics-grid">
                <!-- Left Column: Stats -->
                <div class="analytics-col analytics-col-sm">
                    <div class="info-section">
                        <div class="info-label">Total Dictionary Words:</div>
                        <div class="info-value" id="totalWords">2315</div>
                    </div>
                    
                    <div class="info-section">
                        <div class="info-label">Remaining Valid Words:</div>
                        <div class="info-value" id="remainingWords">2315</div>
                    </div>
                    
                    <div class="info-section">
                        <div class="info-label">Words Eliminated:</div>
                        <div class="info-value" id="eliminatedWords">0</div>
                    </div>
                    
                    <div class="info-section">
                        <div class="info-label">Reduction %:</div>
                        <div class="info-value" id="reductionPercent">0%</div>
                    </div>
                    
                    <div class="info-section">
                        <div class="info-label">Unique Letters Remaining:</div>
                        <div class="info-value" id="uniqueLetters">26</div>
                    </div>
                    
                    <div class="info-section">
                        <div class="info-label">Total Letter Count:</div>
                        <div class="info-value" id="letterCount">-</div>
                    </div>
                </div>
                
                <!-- Middle Column: Charts -->
                <div class="analytics-col analytics-col-md">
                    <div class="analytics-section">
                        <h4 class="analytics-section-title">Total Letters by Position</h4>
                        <div id="columnLengthsChart" class="bar-chart-box">
                            <!-- Bar chart will be dynamically generated here -->
                        </div>
                    </div>
                    
                    <div class="analytics-section">
                        <h4 class="analytics-section-title">Most Common Letters</h4>
                        <div id="mostFrequentTable" class="analytics-box">
                            <!-- Table will be dynamically generated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Right Column: Letters by Position -->
                <div class="analytics-col analytics-col-lg">
                    <div class="analytics-section">
                        <h4 class="analytics-section-title">Letters by Position</h4>
                        <div id="occurrenceTable" class="analytics-box">
                            <!-- Table will be dynamically generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
            </div>

        </section>

        <!-- Screen: Session Analytics -->
        <section id="screen-session" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Session Analytics</h2>
                </div>
                <div class="screen-toolbar-right">
                    <button class="btn btn-secondary" onclick="hideSessionViewer()">← Back to Game</button>
                </div>
            </div>
            <div id="sessionViewer" class="session-viewer-panel" style="display:block;">
                <div id="sessionContent" style="background: var(--bg-secondary); padding: 20px; border-radius: 12px;"></div>
            </div>
        </section>

        <!-- Screen: Bot Demo (Autoplay) -->
        <section id="screen-bot-demo" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Bot Demo</h2>
                    <div class="screen-subtitle">Watch an algorithm play automatically.</div>
                </div>
                <div class="screen-toolbar-middle bot-demo-toolbar-progress">
                    <div class="progress-row">
                        <div id="autoplayProgressText" class="progress-text" role="status" aria-live="polite" aria-atomic="true">Not running</div>
                        <progress id="autoplayProgressBar" value="0" max="100" class="progress-bar" aria-label="Autoplay progress" aria-describedby="autoplayProgressText"></progress>
                    </div>
                </div>
                <div class="screen-toolbar-right">
                    <button id="autoplayBtn" class="btn btn-info" onclick="toggleAutoplay()" aria-controls="autoplayProgressBar botDemoGameHost autoplaySetupPanel">Autoplay Games</button>
                </div>
            </div>

            <details class="panel bot-demo-setup" id="autoplaySetupPanel" open>
                <summary class="bot-demo-setup-summary">Setup</summary>
                <div class="form-grid bot-demo-setup-grid">
                    <div class="form-group">
                        <label for="autoplayGameCount">Number of Games</label>
                        <input type="number" id="autoplayGameCount" min="1" max="1000" value="100" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="autoplayWordLength">Word Length</label>
                        <select id="autoplayWordLength" class="form-input" onchange="filterAutoplayDictionaries()">
                            <option value="4">4 Letters</option>
                            <option value="5" selected>5 Letters</option>
                            <option value="6">6 Letters</option>
                            <option value="7">7 Letters</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="autoplayStrategy">Strategy</label>
                        <select id="autoplayStrategy" class="form-input">
                            <option value="RANDOM">Random Selection</option>
                            <option value="ENTROPY" selected>Maximum Entropy</option>
                            <option value="MOST_COMMON_LETTERS">Most Common Letters</option>
                            <option value="MINIMISE_COLUMN_LENGTHS">Minimise Column Lengths</option>
                            <option value="DICTIONARY_REDUCTION">Dictionary Reduction</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="autoplayDelay">Delay Between Guesses (ms)</label>
                        <input type="number" id="autoplayDelay" min="0" max="5000" step="100" value="1000" class="form-input">
                    </div>
                    <div class="form-group bot-demo-setup-wide">
                        <label for="autoplayDictionary">Dictionary</label>
                        <select id="autoplayDictionary" class="form-input">
                            <option value="">Use first available</option>
                        </select>
                    </div>
                </div>
            </details>

            <div id="botDemoGameHost" class="bot-demo-game-host"></div>
        </section>

        <!-- Screen: Bot Performance (Player Analysis) -->
        <section id="screen-bot-performance" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Bot Performance</h2>
                    <div class="screen-subtitle">Systematically test performance across a dictionary.</div>
                </div>
                <div class="screen-toolbar-right">
                    <button id="startAnalysisBtn" class="btn btn-success" onclick="startPlayerAnalysis()" aria-controls="analysisProgressBar analysisResults analysisSetupPanel">Start Analysis</button>
                    <button id="cancelAnalysisBtn" class="btn btn-danger" onclick="cancelPlayerAnalysis()" aria-controls="analysisProgressBar" disabled>Cancel</button>
                </div>
            </div>

            <div class="panel bot-performance-progress">
                <h3>Progress</h3>
                <div class="progress-row">
                    <div id="analysisProgressText" class="progress-text" role="status" aria-live="polite" aria-atomic="true">Not running</div>
                    <progress id="analysisProgressBar" value="0" max="100" class="progress-bar" aria-label="Analysis progress" aria-describedby="analysisProgressText analysisProgressHint"></progress>
                </div>
                <div class="hint" id="analysisProgressHint">Cancel stops after the current word completes.</div>
            </div>

            <details class="panel bot-performance-setup" id="analysisSetupPanel" open>
                <summary class="bot-performance-setup-summary">Setup</summary>
                <div class="form-grid bot-performance-setup-grid">
                    <div class="form-group">
                        <label for="analysisStrategy">Selection Algorithm</label>
                        <select id="analysisStrategy" class="form-input">
                            <option value="RANDOM">Random Selection</option>
                            <option value="ENTROPY" selected>Maximum Entropy</option>
                            <option value="MOST_COMMON_LETTERS">Most Common Letters</option>
                            <option value="MINIMISE_COLUMN_LENGTHS">Minimise Column Lengths</option>
                            <option value="DICTIONARY_REDUCTION">Dictionary Reduction</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="analysisDictionary">Dictionary</label>
                        <select id="analysisDictionary" class="form-input">
                            <option value="">Loading dictionaries...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="analysisDelay">Delay between games (ms)</label>
                        <input type="number" id="analysisDelay" min="0" max="5000" step="100" value="0" class="form-input">
                    </div>
                </div>
            </details>

            <!-- Player Analysis Results Section (hidden by default) -->
            <div id="analysisResults" class="analysis-results" style="display: none;">
                <div class="analysis-results-header">
                    <h2 class="analysis-results-title">Player Analysis Results</h2>
                    <button class="btn btn-secondary" onclick="hideAnalysisResults()">Close</button>
                </div>

                <div class="panel analysis-results-panel">
                    <h3>Summary Statistics</h3>
                    <div id="analysisSummary"></div>
                    <button class="btn btn-success analysis-download-btn" onclick="downloadAnalysisSummary()">Download Summary CSV</button>
                </div>

                <div class="panel analysis-results-panel">
                    <h3>Detailed Results</h3>
                    <div id="analysisDetails" class="analysis-details-scroll"></div>
                    <button class="btn btn-success analysis-download-btn" onclick="downloadAnalysisDetails()">Download Details CSV</button>
                </div>
            </div>
        </section>

        <!-- Screen: Dictionary Analysis (placeholder) -->
        <section id="screen-dictionary" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Standard (5 Letters)</h2>
                </div>
            </div>

            <div class="dictionary-grid">
                <!-- Left Column: Letter Frequency (full height) -->
                <div class="dictionary-col dictionary-col-left">
                    <div class="panel dictionary-panel dictionary-panel-grow">
                        <h3>Letter Frequency by Position</h3>
                        <div class="dictionary-freq-scroll" id="dictionaryLetterFrequency">
                            <p class="muted-center muted-small">No data loaded.</p>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Complexity Distribution (top) + Words (bottom) -->
                <div class="dictionary-col dictionary-col-right">
                    <div class="panel dictionary-panel">
                        <h3>Complexity Distribution</h3>
                        <div id="dictionaryComplexityDistribution" class="dictionary-distribution">
                            <p class="muted-center muted-small">No data loaded.</p>
                        </div>
                    </div>

                    <div class="panel dictionary-panel dictionary-panel-grow">
                        <h3>Words</h3>
                        <div class="dictionary-words-scroll" id="dictionaryWords">
                            <p class="muted-center muted-small">No dictionary selected.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Screen: Admin (placeholder) -->
        <section id="screen-admin" class="screen" hidden>
            <div class="screen-toolbar">
                <div class="screen-toolbar-left">
                    <h2 class="screen-title">Admin</h2>
                    <div class="screen-subtitle">Not yet implemented.</div>
                </div>
                <div class="screen-toolbar-right">
                    <button class="btn btn-secondary" onclick="checkHealth()">Server Status</button>
                </div>
            </div>
            <div class="panel placeholder-panel">
                <h3>Coming soon</h3>
                <p class="placeholder-text">This screen will manage configuration, users, and server session monitoring.</p>
            </div>
        </section>
    </main>
    <script src="js/game.js?v=15"></script>
</body>
</html>